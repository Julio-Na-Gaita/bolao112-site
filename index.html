<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bolão 112 F.C</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bolão 112">
    <link rel="apple-touch-icon" href="favicon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap');
        
        :root { --dark-green: #006400; --gold: #FFD700; }
        
        body { 
            font-family: 'PT Serif', serif; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            background-color: #f3f4f6;
        }

        /* Replica o CutCornerShape idêntico ao APK */
        .card-cut {
            background: white;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            filter: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07));
        }

        /* Fundos Dinâmicos do APK */
        .bg-main { background-size: cover; background-attachment: fixed; background-position: center; transition: background 0.3s ease; }
        .tab-matches { background-image: linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)), url('bg_jogos.png'); }
        .tab-ranking { background-image: linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)), url('bg_ranking.png'); }
        .tab-rules { background-image: linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)), url('bg_regras.png'); }
        .tab-profile { background-image: linear-gradient(rgba(255,255,255,0.85), rgba(255,255,255,0.85)), url('bg_perfil.png'); }

        .btn-press:active { transform: scale(0.90); transition: 0.1s; }
        
        /* SafeArea para iPhones com Notch */
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }

        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="bg-[#006400] text-white pt-[env(safe-area-inset-top)] sticky top-0 z-50 shadow-md">
        <div class="p-4 flex justify-between items-center">
            <h1 class="text-lg font-bold tracking-tighter uppercase">Bolão 112 F.C</h1>
            <div class="flex gap-4">
                <button id="btnRefresh" class="btn-press"><i class="fas fa-sync-alt text-xl"></i></button>
                <button id="btnLogout" class="hidden btn-press"><i class="fas fa-sign-out-alt text-xl"></i></button>
            </div>
        </div>
    </nav>

    <main id="appContent" class="flex-1 overflow-y-auto bg-main tab-matches pb-32">
        
        <section id="loginScreen" class="flex flex-col items-center justify-center min-h-[70vh] p-6">
            <div class="card-cut w-full max-w-sm p-8 border-t-4 border-[#006400]">
                <h2 class="text-xl font-black text-center text-[#006400] mb-8 uppercase tracking-widest">Acesso Membros</h2>
                <input type="text" id="userInput" placeholder="Usuário" class="w-full p-4 bg-gray-50 border rounded-lg mb-4 outline-none focus:ring-2 focus:ring-green-700 transition-all">
                <input type="password" id="passInput" placeholder="Senha" class="w-full p-4 bg-gray-50 border rounded-lg mb-8 outline-none focus:ring-2 focus:ring-green-700 transition-all">
                <button id="btnLoginAction" class="w-full bg-[#006400] text-white py-4 font-bold rounded-lg btn-press shadow-lg">ACESSAR</button>
            </div>
        </section>

        <div id="mainLists" class="hidden p-4 space-y-4">
            <div id="matchesList" class="space-y-6"></div>
            <div id="rankingContainer" class="hidden"></div>
            <div id="rulesContainer" class="hidden"></div>
            <div id="profileContainer" class="hidden"></div>
        </div>
    </main>

    <nav id="bottomNav" class="hidden fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t safe-bottom flex justify-around p-2 z-50 shadow-2xl">
        <button onclick="showTab('matches')" class="nav-btn flex flex-col items-center text-[#006400]" id="nav-matches"><i class="fas fa-soccer-ball text-lg"></i><span class="text-[10px] mt-1">Confrontos</span></button>
        <button onclick="showTab('ranking')" class="nav-btn flex flex-col items-center text-gray-400" id="nav-ranking"><i class="fas fa-trophy text-lg"></i><span class="text-[10px] mt-1">Ranking</span></button>
        <button onclick="showTab('rules')" class="nav-btn flex flex-col items-center text-gray-400" id="nav-rules"><i class="fas fa-gavel text-lg"></i><span class="text-[10px] mt-1">Regras</span></button>
        <button onclick="showTab('profile')" class="nav-btn flex flex-col items-center text-gray-400" id="nav-profile"><i class="fas fa-user text-lg"></i><span class="text-[10px] mt-1">Perfil</span></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Credenciais Oficiais
        const firebaseConfig = {
            apiKey: "AIzaSyAEkEE2X5hWIqopoJ0D9jFzCjJHKR8b82k",
            authDomain: "bolao112fc.firebaseapp.com",
            projectId: "bolao112fc",
            storageBucket: "bolao112fc.firebasestorage.app",
            messagingSenderId: "131329454158",
            appId: "1:131329454158:web:983e4544dd651ec942131f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        // Lógica de Login
        document.getElementById('btnLoginAction').onclick = async () => {
            const user = document.getElementById('userInput').value.trim().toLowerCase();
            const pass = document.getElementById('passInput').value;
            try { await signInWithEmailAndPassword(auth, `${user}@bolao112.com`, pass); } 
            catch (e) { alert("Usuário ou Senha incorretos."); }
        };

        onAuthStateChanged(auth, user => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainLists').classList.remove('hidden');
                document.getElementById('bottomNav').classList.remove('hidden');
                document.getElementById('btnLogout').classList.remove('hidden');
                showTab('matches');
            } else {
                window.location.reload();
            }
        });

        window.showTab = (tab) => {
            const content = document.getElementById('appContent');
            content.className = `flex-1 overflow-y-auto bg-main pb-32 tab-${tab}`;
            
            // Gerenciar Visibilidade
            document.getElementById('matchesList').classList.toggle('hidden', tab !== 'matches');
            document.getElementById('rankingContainer').classList.toggle('hidden', tab !== 'ranking');
            document.getElementById('rulesContainer').classList.toggle('hidden', tab !== 'rules');
            document.getElementById('profileContainer').classList.toggle('hidden', tab !== 'profile');

            // Gerenciar Cores do Menu
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.replace('text-[#006400]', 'text-gray-400'));
            document.getElementById(`nav-${tab}`).classList.replace('text-gray-400', 'text-[#006400]');

            if(tab === 'matches') loadMatches();
            if(tab === 'ranking') loadRanking();
        };

        async function loadMatches() {
            const list = document.getElementById('matchesList');
            list.innerHTML = `<div class="text-center py-20 text-green-800"><i class="fas fa-spinner fa-spin fa-2x"></i></div>`;
            const snap = await getDocs(collection(db, "matches"));
            const now = new Date();
            list.innerHTML = "";

            snap.forEach(async mDoc => {
                const m = mDoc.data();
                const deadline = m.deadline.toDate();
                const isExpired = now > deadline;
                
                const vRef = doc(db, "guesses", `${mDoc.id}_${currentUser.uid}`);
                const vSnap = await getDoc(vRef);
                const userVote = vSnap.exists() ? vSnap.data().teamSelected : "";

                const card = `
                    <div class="card-cut p-5 relative border-l-[6px] ${isExpired ? 'border-red-600' : 'border-[#006400]'}">
                        <div class="flex justify-between text-[11px] font-bold text-gray-400 mb-5 uppercase tracking-wider">
                            <span>${m.competition} • ${m.round}</span>
                            <span class="${isExpired ? 'text-red-600' : 'text-black'}">${isExpired ? 'Encerrado' : 'Prazo: ' + deadline.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                        </div>
                        
                        <div class="flex items-center justify-between px-2">
                            <button onclick="vote('${mDoc.id}', '${m.teamA}')" ${isExpired ? 'disabled' : ''} class="btn-press flex flex-col items-center w-[42%]">
                                <img src="${m.teamAUrl}" class="w-14 h-14 object-contain mb-3 drop-shadow-sm">
                                <span class="text-[12px] font-black text-center leading-tight ${userVote === m.teamA ? 'text-green-700 underline decoration-2 underline-offset-4' : 'text-gray-800'}">${m.teamA}</span>
                            </button>
                            
                            <span class="italic font-black text-gray-200 text-2xl">VS</span>
                            
                            <button onclick="vote('${mDoc.id}', '${m.teamB}')" ${isExpired ? 'disabled' : ''} class="btn-press flex flex-col items-center w-[42%]">
                                <img src="${m.teamBUrl}" class="w-14 h-14 object-contain mb-3 drop-shadow-sm">
                                <span class="text-[12px] font-black text-center leading-tight ${userVote === m.teamB ? 'text-green-700 underline decoration-2 underline-offset-4' : 'text-gray-800'}">${m.teamB}</span>
                            </button>
                        </div>
                        ${userVote && !isExpired ? `<p class="text-center text-[11px] text-green-700 font-bold mt-5 bg-green-50 py-1 rounded">Seu voto: ${userVote}</p>` : ''}
                        ${m.winner ? `<div class="mt-5 text-center border-t pt-3"><span class="text-[10px] text-gray-400 font-bold">RESULTADO</span><p class="text-green-700 font-black text-lg">${m.winner}</p></div>` : ''}
                    </div>
                `;
                list.innerHTML += card;
            });
        }

        window.vote = async (mId, team) => {
            await setDoc(doc(db, "guesses", `${mId}_${currentUser.uid}`), { matchId: mId, userId: currentUser.uid, teamSelected: team, timestamp: new Date() });
            loadMatches();
        };

        document.getElementById('btnRefresh').onclick = () => loadMatches();
        document.getElementById('btnLogout').onclick = () => signOut(auth);

    </script>
</body>
</html>
