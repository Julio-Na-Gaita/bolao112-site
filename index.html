<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bol√£o 112 F.C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap');
        :root { --dark-green: #006400; --gold: #FFD700; }
        body { font-family: 'PT Serif', serif; -webkit-tap-highlight-color: transparent; }
        
        .card-cut {
            background: white;
            clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .bg-app { background-size: cover; background-attachment: fixed; background-position: center; }
        .bg-jogos { background-image: linear-gradient(rgba(255,255,255,0.8), rgba(255,255,255,0.8)), url('bg_jogos.png'); }
        .bg-ranking { background-image: linear-gradient(rgba(255,255,255,0.8), rgba(255,255,255,0.8)), url('bg_ranking.png'); }
        .bg-regras { background-image: linear-gradient(rgba(255,255,255,0.8), rgba(255,255,255,0.8)), url('bg_regras.png'); }
        .bg-perfil { background-image: linear-gradient(rgba(255,255,255,0.8), rgba(255,255,255,0.8)), url('bg_perfil.png'); }

        .btn-press:active { transform: scale(0.92); transition: transform 0.1s; }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <nav class="bg-[#006400] text-white p-4 sticky top-0 z-50 shadow-md flex justify-between items-center">
        <h1 class="text-lg font-bold uppercase">Bol√£o 112 F.C</h1>
        <div class="flex gap-3">
            <button id="btnRefresh" class="p-2"><i class="fas fa-sync-alt"></i></button>
            <button id="btnLogout" class="hidden p-2"><i class="fas fa-sign-out-alt"></i></button>
        </div>
    </nav>

    <main id="appContent" class="flex-1 overflow-y-auto relative pb-24 transition-all duration-300">
        
        <section id="loginScreen" class="flex flex-col items-center justify-center min-h-[80vh] p-6">
            <div class="card-cut w-full max-w-sm p-8 border-2 border-[#006400]">
                <h2 class="text-xl font-black text-center text-[#006400] mb-8 uppercase">Acesso Membros</h2>
                <input type="text" id="userInput" placeholder="Usu√°rio" class="w-full p-3 border rounded-lg mb-4 outline-none focus:ring-2 focus:ring-green-700">
                <input type="password" id="passInput" placeholder="Senha" class="w-full p-3 border rounded-lg mb-6 outline-none focus:ring-2 focus:ring-green-700">
                <button id="btnLoginAction" class="w-full bg-[#006400] text-white py-3 font-bold rounded-lg btn-press">ACESSAR</button>
            </div>
        </section>

        <section id="matchesScreen" class="hidden p-4 space-y-4"></section>

        <section id="rankingScreen" class="hidden p-4">
            <div class="card-cut p-4 mb-4">
                <h3 class="text-center font-bold text-lg mb-4">Classifica√ß√£o</h3>
                <div class="grid grid-cols-6 text-[10px] font-bold text-gray-400 uppercase text-center border-b pb-2">
                    <span>Pos</span><span class="col-span-2 text-left">Nome</span><span>D</span><span>V</span><span>PTS</span>
                </div>
                <div id="rankingList" class="mt-2 space-y-2"></div>
            </div>
        </section>

        <section id="rulesScreen" class="hidden p-4 space-y-4">
            <div class="card-cut p-6 border-2 border-[#006400] text-center mb-6">
                <h2 class="text-xl font-black text-[#006400]">REGULAMENTO 2026</h2>
            </div>
            <div id="rulesAccordion" class="space-y-2"></div>
        </section>

        <section id="profileScreen" class="hidden p-4">
            <div class="card-cut p-8 border-2 border-[#006400] text-center">
                <h2 class="font-bold text-gray-500 mb-4 tracking-widest">CART√ÉO DE MEMBRO</h2>
                <div id="profileAvatar" class="w-24 h-24 bg-gray-200 rounded-full mx-auto mb-4 border-2 border-gray-300 overflow-hidden flex items-center justify-center">
                    <i class="fas fa-user text-4xl text-gray-400"></i>
                </div>
                <h3 id="profileName" class="text-xl font-black uppercase">...</h3>
                <p id="profileUser" class="text-gray-500 text-sm mb-6">@...</p>
                <div id="financialStatus" class="p-4 rounded-lg font-bold text-sm mb-4">Carregando status...</div>
            </div>
        </section>

    </main>

    <nav id="bottomNav" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 pb-6 z-50">
        <button onclick="showTab('matches')" class="nav-item flex flex-col items-center text-gray-400" id="nav-matches"><i class="fas fa-soccer-ball"></i><span class="text-[10px]">Jogos</span></button>
        <button onclick="showTab('ranking')" class="nav-item flex flex-col items-center text-gray-400" id="nav-ranking"><i class="fas fa-trophy"></i><span class="text-[10px]">Ranking</span></button>
        <button onclick="showTab('rules')" class="nav-item flex flex-col items-center text-gray-400" id="nav-rules"><i class="fas fa-gavel"></i><span class="text-[10px]">Regras</span></button>
        <button onclick="showTab('profile')" class="nav-item flex flex-col items-center text-gray-400" id="nav-profile"><i class="fas fa-user"></i><span class="text-[10px]">Perfil</span></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, doc, getDoc, setDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAEkEE2X5hWIqopoJ0D9jFzCjJHKR8b82k",
            authDomain: "bolao112fc.firebaseapp.com",
            projectId: "bolao112fc",
            storageBucket: "bolao112fc.firebasestorage.app",
            messagingSenderId: "131329454158",
            appId: "1:131329454158:web:983e4544dd651ec942131f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        // Regras (Accordion)
        const rules = [
            { t: "1Ô∏è‚É£ FINANCEIRO", c: "üí∞ Aporte Mensal: R$ 10,00. Vencimento: todo dia 10." },
            { t: "3Ô∏è‚É£ PONTUA√á√ÉO", c: "‚úÖ Acerto: 3 pts. üèÜ Finais: 6 pts. üåü Oitavas Perfeitas: +3 pts." },
            { t: "5Ô∏è‚É£ DESEMPATE", c: "1. Menor inadimpl√™ncia. 2. Vit√≥rias. 3. Finais ganhas." }
        ];

        document.getElementById('btnLoginAction').onclick = async () => {
            const user = document.getElementById('userInput').value.trim().toLowerCase();
            const pass = document.getElementById('passInput').value;
            try { await signInWithEmailAndPassword(auth, `${user}@bolao112.com`, pass); } 
            catch (e) { alert("Acesso negado."); }
        };

        onAuthStateChanged(auth, user => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('bottomNav').classList.remove('hidden');
                document.getElementById('btnLogout').classList.remove('hidden');
                showTab('matches');
            } else {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('bottomNav').classList.add('hidden');
            }
        });

        window.showTab = (tab) => {
            const screens = ['matchesScreen', 'rankingScreen', 'rulesScreen', 'profileScreen'];
            screens.forEach(s => document.getElementById(s).classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.replace('text-[#006400]', 'text-gray-400'));
            
            const main = document.getElementById('appContent');
            main.className = `flex-1 overflow-y-auto bg-app pb-24 bg-${tab}`;
            document.getElementById(`${tab}Screen`).classList.remove('hidden');
            document.getElementById(`nav-${tab}`).classList.replace('text-gray-400', 'text-[#006400]');

            if(tab === 'matches') loadMatches();
            if(tab === 'rules') renderRules();
            if(tab === 'profile') loadProfile();
        };

        async function loadMatches() {
            const container = document.getElementById('matchesScreen');
            container.innerHTML = `<div class="text-center py-10"><i class="fas fa-spinner fa-spin text-2xl"></i></div>`;
            const snap = await getDocs(collection(db, "matches"));
            const now = new Date();
            container.innerHTML = "";

            snap.forEach(async mDoc => {
                const m = mDoc.data();
                const deadline = m.deadline.toDate();
                const expired = now > deadline;
                const vRef = doc(db, "guesses", `${mDoc.id}_${currentUser.uid}`);
                const vSnap = await getDoc(vRef);
                const userVote = vSnap.exists() ? vSnap.data().teamSelected : "";

                container.innerHTML += `
                    <div class="card-cut p-4 border-l-4 ${expired ? 'border-red-500' : 'border-[#006400]'}">
                        <div class="flex justify-between text-[10px] font-bold text-gray-500 mb-4 uppercase">
                            <span>${m.competition}</span>
                            <span class="${expired ? 'text-red-600' : 'text-black'}">${expired ? 'ENCERRADO' : 'FECHA: ' + deadline.toLocaleTimeString()}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <button onclick="vote('${mDoc.id}', '${m.teamA}')" ${expired ? 'disabled' : ''} class="btn-press flex flex-col items-center w-5/12">
                                <img src="${m.teamAUrl}" class="w-10 h-10 mb-2 object-contain">
                                <span class="text-[11px] font-bold ${userVote === m.teamA ? 'text-blue-600 underline' : ''}">${m.teamA}</span>
                            </button>
                            <span class="italic text-gray-300 font-black">VS</span>
                            <button onclick="vote('${mDoc.id}', '${m.teamB}')" ${expired ? 'disabled' : ''} class="btn-press flex flex-col items-center w-5/12">
                                <img src="${m.teamBUrl}" class="w-10 h-10 mb-2 object-contain">
                                <span class="text-[11px] font-bold ${userVote === m.teamB ? 'text-blue-600 underline' : ''}">${m.teamB}</span>
                            </button>
                        </div>
                    </div>`;
            });
        }

        window.vote = async (id, team) => {
            await setDoc(doc(db, "guesses", `${id}_${currentUser.uid}`), { matchId: id, userId: currentUser.uid, teamSelected: team, timestamp: new Date() });
            loadMatches();
        };

        function renderRules() {
            const acc = document.getElementById('rulesAccordion');
            acc.innerHTML = rules.map(r => `
                <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-200">
                    <button class="w-full text-left font-bold text-sm text-[#006400] flex justify-between items-center" onclick="this.nextElementSibling.classList.toggle('hidden')">
                        ${r.t} <i class="fas fa-chevron-down text-[10px]"></i>
                    </button>
                    <div class="hidden mt-2 text-xs text-gray-600 leading-relaxed">${r.c}</div>
                </div>`).join('');
        }

        async function loadProfile() {
            const userDoc = await getDoc(doc(db, "users", currentUser.uid));
            if(userDoc.exists()) {
                const d = userDoc.data();
                document.getElementById('profileName').innerText = d.name || "Sem Nome";
                document.getElementById('profileUser').innerText = `@${d.username || "user"}`;
                if(d.photoBase64) document.getElementById('profileAvatar').innerHTML = `<img src="data:image/jpeg;base64,${d.photoBase64}" class="w-full h-full object-cover">`;
                
                const statusBox = document.getElementById('financialStatus');
                const isPaid = d.payments && d.payments['Jan']; // Exemplo simplificado
                statusBox.innerText = isPaid ? "MENSALIDADE EM DIA" : "PAGAMENTO PENDENTE";
                statusBox.className = `p-4 rounded-lg font-bold text-sm mb-4 ${isPaid ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
            }
        }

        document.getElementById('btnRefresh').onclick = () => loadMatches();
        document.getElementById('btnLogout').onclick = () => signOut(auth);
    </script>
</body>
</html>
